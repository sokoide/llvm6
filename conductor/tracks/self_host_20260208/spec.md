# Specification: Self-hosting Tiny-C Compiler (Pure C Version)

## 1. Overview
`src/` に実装された純粋なC言語版 Tiny-C コンパイラを拡張し、コンパイラ自身のソースコードを自分自身でコンパイル可能にする（セルフホスティング）。
本トラックでは、実際にソースコードをコンパイルしながら発生するパースエラーやコード生成の不備を順次解消していく「エラー駆動型」の実装戦略をとる。

## 2. Functional Requirements
### 言語機能の拡充
セルフホストに必要とされる以下の機能を優先的に実装する。
- **構造体 (struct) と共用体 (union) の完全サポート**: ネスト、アライメント、ビットフィールド（必要に応じて）等。
- **型定義 (typedef) と列挙型 (enum)**: システムヘッダーや自身の内部データ構造のパースに必須。
- **高度な演算子と式**: 
    - ビット演算子 (`&`, `|`, `^`, `~`, `<<`, `>>`)
    - 三項演算子 (`? :`)
    - 複合代入演算子 (`+=`, `-=`, `*=`, `/=`, `%=`, `&=`, `|=`, `^=`, `<<=`, `>>=`)
- **関数ポインタ**: 動的な関数呼び出しへの対応。

### システム連携
- **外部ヘッダーのサポート**: プリプロセッサ (`gcc -E` 等) によって展開された実際のシステムヘッダー (`stdio.h`, `stdlib.h` 等) に含まれる複雑な型定義や宣言を正しく処理できるようにする。

## 3. Implementation Strategy
- **エラー駆動型ビルド**:
    1. 既存のコンパイラ (GCC/Clang) でビルドした Tiny-C (`tc1`) を使用して、自身のソースコード (`src/*.c`) をコンパイルする。
    2. 発生したパースエラーやセマンティックエラーを特定し、機能を実装・修正する。
    3. このサイクルを、自分自身の全ソースコードがエラーなく LLVM IR に変換されるまで繰り返す。

## 4. Acceptance Criteria
- **2段階ビルド (Bootstrapping) の成功**:
    1. GCC等でビルドした Tiny-C (`tc1`) が、自身のソースをコンパイルして `tc2` の LLVM IR を生成する。
    2. 生成された `tc2` の IR を実行バイナリに変換し、その `tc2` が自身のソースをコンパイルして `tc3` の IR を生成する。
    3. `tc2` が出力した IR と `tc3` が出力した IR が（メタデータを除き）機能的に完全に一致することを確認する。
- **既存テストの維持**: 新機能実装後も `make test` の全テストケースが通過すること。

## 5. Out of Scope
- インラインアセンブリのサポート。
- C99/C11 の全機能（複素数、可変長配列など、セルフホストに不要なもの）。
